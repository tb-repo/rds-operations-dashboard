# S3 Bucket Structure

**Generated by:** claude-3.5-sonnet  
**Timestamp:** 2025-11-12T17:00:00Z  
**Version:** 1.0.0  
**Policy Version:** v1.0.0  
**Traceability:** REQ-1.3, REQ-4.2, REQ-6.4 → DESIGN-001 → TASK-1.2

## Bucket Name

`rds-dashboard-data-{account-id}-{environment}`

Example: `rds-dashboard-data-123456789012-prod`

## Folder Structure

```
rds-dashboard-data-{account-id}-{environment}/
├── historical-metrics/
│   └── {year}/{month}/{day}/
│       ├── {instance_id}_CPUUtilization.json.gz
│       ├── {instance_id}_DatabaseConnections.json.gz
│       ├── {instance_id}_FreeStorageSpace.json.gz
│       └── ...
│
├── compliance-reports/
│   └── {year}/{month}/
│       ├── compliance_report_2025-11-12.json
│       ├── compliance_report_2025-11-13.json
│       └── ...
│
├── cost-reports/
│   └── {year}/{month}/
│       ├── cost_analysis_2025-11-12.json
│       ├── cost_analysis_2025-11-13.json
│       └── ...
│
├── cloudops-requests/
│   └── {year}/{month}/{day}/
│       ├── request_550e8400-e29b-41d4-a716-446655440000.md
│       ├── request_660e8400-e29b-41d4-a716-446655440001.md
│       └── ...
│
└── templates/
    ├── cloudops_scaling_template.md
    ├── cloudops_parameter_change_template.md
    └── cloudops_maintenance_template.md
```

## Lifecycle Policies

### Historical Metrics
- **Path:** `historical-metrics/`
- **Retention:** 7 days
- **Action:** Delete after 7 days
- **Rationale:** Metrics are cached in DynamoDB for recent access; S3 is for archival only

### Compliance Reports
- **Path:** `compliance-reports/`
- **Retention:** 90 days in Standard, then Glacier
- **Action:** Transition to Glacier after 90 days
- **Rationale:** Compliance audit trail, infrequent access after 90 days

### Cost Reports
- **Path:** `cost-reports/`
- **Retention:** 90 days in Standard, then Glacier
- **Action:** Transition to Glacier after 90 days
- **Rationale:** Cost analysis history, infrequent access after 90 days

### CloudOps Requests
- **Path:** `cloudops-requests/`
- **Retention:** 1 year
- **Action:** Delete after 365 days
- **Rationale:** Operational history, no long-term retention required

### Templates
- **Path:** `templates/`
- **Retention:** No expiration
- **Action:** None
- **Rationale:** Static templates, always needed

## Security Configuration

- **Versioning:** Enabled (data protection)
- **Encryption:** SSE-S3 (server-side encryption with S3-managed keys)
- **Public Access:** Blocked (all public access blocked)
- **SSL/TLS:** Required (enforceSSL enabled)
- **Access:** IAM role-based (Lambda execution role only)

## File Formats

### Historical Metrics
```json
{
  "instance_id": "prod-postgres-01",
  "metric_name": "CPUUtilization",
  "period": 3600,
  "statistics": "Average",
  "datapoints": [
    {
      "timestamp": "2025-11-12T00:00:00Z",
      "value": 45.2,
      "unit": "Percent"
    },
    {
      "timestamp": "2025-11-12T01:00:00Z",
      "value": 47.8,
      "unit": "Percent"
    }
  ],
  "collected_at": "2025-11-12T16:00:00Z"
}
```

### Compliance Reports
```json
{
  "report_date": "2025-11-12",
  "total_instances": 52,
  "compliant_instances": 48,
  "violations": [
    {
      "instance_id": "dev-postgres-01",
      "violation_type": "backup_retention",
      "severity": "high",
      "current_value": 3,
      "required_value": 7,
      "remediation": "Increase backup retention to 7 days"
    }
  ],
  "summary": {
    "critical": 1,
    "high": 2,
    "medium": 1,
    "low": 0
  }
}
```

### Cost Reports
```json
{
  "report_date": "2025-11-12",
  "total_monthly_cost": 12450.75,
  "cost_by_account": {
    "123456789012": 8500.50,
    "234567890123": 3950.25
  },
  "cost_by_region": {
    "ap-southeast-1": 9338.06,
    "eu-west-2": 1867.61,
    "ap-south-1": 622.54,
    "us-east-1": 622.54
  },
  "cost_by_engine": {
    "postgres": 7470.45,
    "oracle": 3726.23,
    "sqlserver": 1254.07
  },
  "optimization_opportunities": [
    {
      "instance_id": "dev-postgres-02",
      "recommendation": "Right-size to db.t3.medium",
      "potential_savings": 125.50
    }
  ]
}
```

### CloudOps Requests
```markdown
# CloudOps Request: Scale RDS Instance

**Request ID:** 550e8400-e29b-41d4-a716-446655440000  
**Requested By:** john.doe@company.com  
**Request Date:** 2025-11-12T16:00:00Z  
**Priority:** Medium

## Instance Details

- **Instance ID:** prod-postgres-01
- **Account:** Production (123456789012)
- **Region:** ap-southeast-1
- **Current Class:** db.r6g.xlarge
- **Engine:** PostgreSQL 15.4

## Requested Change

Scale instance from db.r6g.xlarge to db.r6g.2xlarge

## Justification

CPU utilization consistently above 80% during peak hours. Application performance degradation observed.

## Impact Assessment

- **Estimated Downtime:** 5-10 minutes
- **Cost Impact:** +$250/month
- **Risk Level:** Medium

## Rollback Plan

If performance issues persist, revert to db.r6g.xlarge within 24 hours.

## Compliance Status

- ✅ Backups: Enabled (7-day retention)
- ✅ Encryption: Enabled
- ✅ Patch Level: Current (15.4)
- ✅ Multi-AZ: Enabled
```

## Access Patterns

### Lambda Functions
- **Discovery Service:** Write to `historical-metrics/`
- **Health Monitor:** Write to `historical-metrics/`
- **Cost Analyzer:** Write to `cost-reports/`
- **Compliance Checker:** Write to `compliance-reports/`
- **CloudOps Generator:** Read from `templates/`, write to `cloudops-requests/`
- **Query Handler:** Read from all folders

### Dashboard
- Read-only access via API Gateway (no direct S3 access)

## Cost Estimation

Based on 50 RDS instances:

- **Storage:** ~5 GB/month = $0.12/month
- **Requests:** ~10,000 PUT/GET = $0.05/month
- **Data Transfer:** Minimal (same region) = $0.01/month
- **Glacier Storage:** ~2 GB after 90 days = $0.01/month
- **Total:** ~$0.19/month

## Monitoring

- CloudWatch metric: `BucketSizeBytes`
- CloudWatch metric: `NumberOfObjects`
- CloudWatch alarm: Alert if bucket size > 10 GB (unexpected growth)
