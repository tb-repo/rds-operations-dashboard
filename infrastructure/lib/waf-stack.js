"use strict";
/*
 * WAF Stack - Web Application Firewall
 *
 * Generated by: claude-3.5-sonnet
 * Timestamp: 2025-12-03T00:00:00Z
 * Version: 1.0.0
 * Policy Version: v1.0.0
 * Traceability: REQ-6.1 → DESIGN-6.1 → TASK-9.1
 * Review Status: Pending
 * Risk Level: Level 2
 *
 * Purpose: Deploy AWS WAF to protect API Gateway and CloudFront distributions
 * from common web exploits and attacks.
 *
 * Features:
 * - OWASP Top 10 protection
 * - Rate limiting (100 requests per 5 minutes per IP)
 * - Geo-blocking capabilities
 * - SQL injection and XSS protection
 * - Bot control
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.WafStack = void 0;
const cdk = __importStar(require("aws-cdk-lib"));
const wafv2 = __importStar(require("aws-cdk-lib/aws-wafv2"));
class WafStack extends cdk.Stack {
    constructor(scope, id, props) {
        super(scope, id, props);
        const rateLimit = props.rateLimit ?? 100;
        const blockedCountries = props.blockedCountries ?? [];
        const enableOWASPRules = props.enableOWASPRules ?? true;
        const enableBotControl = props.enableBotControl ?? true;
        // Build rules array
        const rules = [];
        let priority = 0;
        // Rule 0: Allow BFF requests (whitelist)
        rules.push({
            name: 'AllowBFFRequests',
            priority: priority++,
            statement: {
                byteMatchStatement: {
                    searchString: 'true',
                    fieldToMatch: {
                        singleHeader: {
                            name: 'x-bff-request',
                        },
                    },
                    textTransformations: [
                        {
                            priority: 0,
                            type: 'NONE',
                        },
                    ],
                    positionalConstraint: 'EXACTLY',
                },
            },
            action: {
                allow: {},
            },
            visibilityConfig: {
                sampledRequestsEnabled: true,
                cloudWatchMetricsEnabled: true,
                metricName: 'AllowBFFRequests',
            },
        });
        // Rule 1: Rate limiting
        rules.push({
            name: 'RateLimitRule',
            priority: priority++,
            statement: {
                rateBasedStatement: {
                    limit: rateLimit,
                    aggregateKeyType: 'IP',
                },
            },
            action: {
                block: {
                    customResponse: {
                        responseCode: 429,
                        customResponseBodyKey: 'RateLimitExceeded',
                    },
                },
            },
            visibilityConfig: {
                sampledRequestsEnabled: true,
                cloudWatchMetricsEnabled: true,
                metricName: 'RateLimitRule',
            },
        });
        // Rule 2: Geo-blocking (if countries specified)
        if (blockedCountries.length > 0) {
            rules.push({
                name: 'GeoBlockingRule',
                priority: priority++,
                statement: {
                    geoMatchStatement: {
                        countryCodes: blockedCountries,
                    },
                },
                action: {
                    block: {
                        customResponse: {
                            responseCode: 403,
                            customResponseBodyKey: 'GeoBlocked',
                        },
                    },
                },
                visibilityConfig: {
                    sampledRequestsEnabled: true,
                    cloudWatchMetricsEnabled: true,
                    metricName: 'GeoBlockingRule',
                },
            });
        }
        // Rule 3: AWS Managed Rules - Core Rule Set (OWASP Top 10)
        if (enableOWASPRules) {
            rules.push({
                name: 'AWSManagedRulesCommonRuleSet',
                priority: priority++,
                statement: {
                    managedRuleGroupStatement: {
                        vendorName: 'AWS',
                        name: 'AWSManagedRulesCommonRuleSet',
                        // Exclude rules that might cause false positives
                        excludedRules: [
                            { name: 'SizeRestrictions_BODY' }, // Allow larger request bodies
                            { name: 'GenericRFI_BODY' }, // Can cause false positives with JSON
                        ],
                    },
                },
                overrideAction: {
                    none: {},
                },
                visibilityConfig: {
                    sampledRequestsEnabled: true,
                    cloudWatchMetricsEnabled: true,
                    metricName: 'AWSManagedRulesCommonRuleSet',
                },
            });
            // Rule 4: AWS Managed Rules - Known Bad Inputs
            rules.push({
                name: 'AWSManagedRulesKnownBadInputsRuleSet',
                priority: priority++,
                statement: {
                    managedRuleGroupStatement: {
                        vendorName: 'AWS',
                        name: 'AWSManagedRulesKnownBadInputsRuleSet',
                    },
                },
                overrideAction: {
                    none: {},
                },
                visibilityConfig: {
                    sampledRequestsEnabled: true,
                    cloudWatchMetricsEnabled: true,
                    metricName: 'AWSManagedRulesKnownBadInputsRuleSet',
                },
            });
            // Rule 5: AWS Managed Rules - SQL Injection
            rules.push({
                name: 'AWSManagedRulesSQLiRuleSet',
                priority: priority++,
                statement: {
                    managedRuleGroupStatement: {
                        vendorName: 'AWS',
                        name: 'AWSManagedRulesSQLiRuleSet',
                    },
                },
                overrideAction: {
                    none: {},
                },
                visibilityConfig: {
                    sampledRequestsEnabled: true,
                    cloudWatchMetricsEnabled: true,
                    metricName: 'AWSManagedRulesSQLiRuleSet',
                },
            });
        }
        // Rule 6: Bot Control (if enabled)
        if (enableBotControl) {
            rules.push({
                name: 'AWSManagedRulesBotControlRuleSet',
                priority: priority++,
                statement: {
                    managedRuleGroupStatement: {
                        vendorName: 'AWS',
                        name: 'AWSManagedRulesBotControlRuleSet',
                        // Configure bot control
                        managedRuleGroupConfigs: [
                            {
                                awsManagedRulesBotControlRuleSet: {
                                    inspectionLevel: 'COMMON', // COMMON or TARGETED
                                },
                            },
                        ],
                    },
                },
                overrideAction: {
                    none: {},
                },
                visibilityConfig: {
                    sampledRequestsEnabled: true,
                    cloudWatchMetricsEnabled: true,
                    metricName: 'AWSManagedRulesBotControlRuleSet',
                },
            });
        }
        // Create Web ACL
        this.webAcl = new wafv2.CfnWebACL(this, 'WebACL', {
            name: `${id}-WebACL`,
            scope: 'REGIONAL', // Use 'CLOUDFRONT' for CloudFront distributions
            defaultAction: {
                allow: {}, // Allow by default, block based on rules
            },
            rules,
            visibilityConfig: {
                sampledRequestsEnabled: true,
                cloudWatchMetricsEnabled: true,
                metricName: 'WebACL',
            },
            customResponseBodies: {
                RateLimitExceeded: {
                    contentType: 'APPLICATION_JSON',
                    content: JSON.stringify({
                        error: 'Rate limit exceeded',
                        message: 'Too many requests. Please try again later.',
                    }),
                },
                GeoBlocked: {
                    contentType: 'APPLICATION_JSON',
                    content: JSON.stringify({
                        error: 'Access denied',
                        message: 'Access from your location is not permitted.',
                    }),
                },
            },
        });
        this.webAclArn = this.webAcl.attrArn;
        // Associate with API Gateway if provided
        if (props.apiGateway) {
            const stage = props.apiGateway.deploymentStage;
            const stageArn = `arn:aws:apigateway:${this.region}::/restapis/${props.apiGateway.restApiId}/stages/${stage.stageName}`;
            new wafv2.CfnWebACLAssociation(this, 'WebACLAssociation', {
                resourceArn: stageArn,
                webAclArn: this.webAclArn,
            });
            new cdk.CfnOutput(this, 'WebACLAssociatedWithAPI', {
                value: props.apiGateway.restApiId,
                description: 'API Gateway protected by WAF',
            });
        }
        // Outputs
        new cdk.CfnOutput(this, 'WebACLId', {
            value: this.webAcl.attrId,
            description: 'WAF Web ACL ID',
            exportName: `${id}-WebACLId`,
        });
        new cdk.CfnOutput(this, 'WebACLArn', {
            value: this.webAclArn,
            description: 'WAF Web ACL ARN',
            exportName: `${id}-WebACLArn`,
        });
        // CloudWatch Dashboard for WAF metrics
        this.createWafDashboard();
        // Tags
        cdk.Tags.of(this).add('Component', 'Security');
        cdk.Tags.of(this).add('ManagedBy', 'CDK');
        cdk.Tags.of(this).add('Purpose', 'WAF Protection');
    }
    createWafDashboard() {
        // Note: CloudWatch Dashboard creation would go here
        // For now, we'll rely on the built-in WAF metrics in CloudWatch
        // Key metrics to monitor:
        // - AllowedRequests
        // - BlockedRequests
        // - CountedRequests
        // - PassedRequests
        // - RateLimitRule (custom metric)
        // - GeoBlockingRule (custom metric)
        // These are automatically available in CloudWatch under AWS/WAFV2
    }
}
exports.WafStack = WafStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2FmLXN0YWNrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsid2FmLXN0YWNrLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FvQkc7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILGlEQUFtQztBQUNuQyw2REFBK0M7QUFtQy9DLE1BQWEsUUFBUyxTQUFRLEdBQUcsQ0FBQyxLQUFLO0lBSXJDLFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBb0I7UUFDNUQsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFFeEIsTUFBTSxTQUFTLEdBQUcsS0FBSyxDQUFDLFNBQVMsSUFBSSxHQUFHLENBQUM7UUFDekMsTUFBTSxnQkFBZ0IsR0FBRyxLQUFLLENBQUMsZ0JBQWdCLElBQUksRUFBRSxDQUFDO1FBQ3RELE1BQU0sZ0JBQWdCLEdBQUcsS0FBSyxDQUFDLGdCQUFnQixJQUFJLElBQUksQ0FBQztRQUN4RCxNQUFNLGdCQUFnQixHQUFHLEtBQUssQ0FBQyxnQkFBZ0IsSUFBSSxJQUFJLENBQUM7UUFFeEQsb0JBQW9CO1FBQ3BCLE1BQU0sS0FBSyxHQUFtQyxFQUFFLENBQUM7UUFDakQsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBRWpCLHlDQUF5QztRQUN6QyxLQUFLLENBQUMsSUFBSSxDQUFDO1lBQ1QsSUFBSSxFQUFFLGtCQUFrQjtZQUN4QixRQUFRLEVBQUUsUUFBUSxFQUFFO1lBQ3BCLFNBQVMsRUFBRTtnQkFDVCxrQkFBa0IsRUFBRTtvQkFDbEIsWUFBWSxFQUFFLE1BQU07b0JBQ3BCLFlBQVksRUFBRTt3QkFDWixZQUFZLEVBQUU7NEJBQ1osSUFBSSxFQUFFLGVBQWU7eUJBQ3RCO3FCQUNGO29CQUNELG1CQUFtQixFQUFFO3dCQUNuQjs0QkFDRSxRQUFRLEVBQUUsQ0FBQzs0QkFDWCxJQUFJLEVBQUUsTUFBTTt5QkFDYjtxQkFDRjtv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UUFDeEIsb0RBQW9EO1FBQ3BELGdFQUFnRTtRQUVoRSwwQkFBMEI7UUFDMUIsb0JBQW9CO1FBQ3BCLG9CQUFvQjtRQUNwQixvQkFBb0I7UUFDcEIsbUJBQW1CO1FBQ25CLGtDQUFrQztRQUNsQyxvQ0FBb0M7UUFFcEMsa0VBQWtFO0lBQ3BFLENBQUM7Q0FDRjtBQXhSRCw0QkF3UkMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gKiBXQUYgU3RhY2sgLSBXZWIgQXBwbGljYXRpb24gRmlyZXdhbGxcclxuICogXHJcbiAqIEdlbmVyYXRlZCBieTogY2xhdWRlLTMuNS1zb25uZXRcclxuICogVGltZXN0YW1wOiAyMDI1LTEyLTAzVDAwOjAwOjAwWlxyXG4gKiBWZXJzaW9uOiAxLjAuMFxyXG4gKiBQb2xpY3kgVmVyc2lvbjogdjEuMC4wXHJcbiAqIFRyYWNlYWJpbGl0eTogUkVRLTYuMSDihpIgREVTSUdOLTYuMSDihpIgVEFTSy05LjFcclxuICogUmV2aWV3IFN0YXR1czogUGVuZGluZ1xyXG4gKiBSaXNrIExldmVsOiBMZXZlbCAyXHJcbiAqIFxyXG4gKiBQdXJwb3NlOiBEZXBsb3kgQVdTIFdBRiB0byBwcm90ZWN0IEFQSSBHYXRld2F5IGFuZCBDbG91ZEZyb250IGRpc3RyaWJ1dGlvbnNcclxuICogZnJvbSBjb21tb24gd2ViIGV4cGxvaXRzIGFuZCBhdHRhY2tzLlxyXG4gKiBcclxuICogRmVhdHVyZXM6XHJcbiAqIC0gT1dBU1AgVG9wIDEwIHByb3RlY3Rpb25cclxuICogLSBSYXRlIGxpbWl0aW5nICgxMDAgcmVxdWVzdHMgcGVyIDUgbWludXRlcyBwZXIgSVApXHJcbiAqIC0gR2VvLWJsb2NraW5nIGNhcGFiaWxpdGllc1xyXG4gKiAtIFNRTCBpbmplY3Rpb24gYW5kIFhTUyBwcm90ZWN0aW9uXHJcbiAqIC0gQm90IGNvbnRyb2xcclxuICovXHJcblxyXG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnYXdzLWNkay1saWInO1xyXG5pbXBvcnQgKiBhcyB3YWZ2MiBmcm9tICdhd3MtY2RrLWxpYi9hd3Mtd2FmdjInO1xyXG5pbXBvcnQgKiBhcyBhcGlnYXRld2F5IGZyb20gJ2F3cy1jZGstbGliL2F3cy1hcGlnYXRld2F5JztcclxuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFdhZlN0YWNrUHJvcHMgZXh0ZW5kcyBjZGsuU3RhY2tQcm9wcyB7XHJcbiAgLyoqXHJcbiAgICogQVBJIEdhdGV3YXkgUkVTVCBBUEkgdG8gcHJvdGVjdFxyXG4gICAqL1xyXG4gIGFwaUdhdGV3YXk/OiBhcGlnYXRld2F5LlJlc3RBcGk7XHJcbiAgXHJcbiAgLyoqXHJcbiAgICogUmF0ZSBsaW1pdCBwZXIgSVAgKHJlcXVlc3RzIHBlciA1IG1pbnV0ZXMpXHJcbiAgICogRGVmYXVsdDogMTAwXHJcbiAgICovXHJcbiAgcmF0ZUxpbWl0PzogbnVtYmVyO1xyXG4gIFxyXG4gIC8qKlxyXG4gICAqIExpc3Qgb2YgY291bnRyeSBjb2RlcyB0byBibG9jayAoSVNPIDMxNjYtMSBhbHBoYS0yKVxyXG4gICAqIEV4YW1wbGU6IFsnQ04nLCAnUlUnXVxyXG4gICAqL1xyXG4gIGJsb2NrZWRDb3VudHJpZXM/OiBzdHJpbmdbXTtcclxuICBcclxuICAvKipcclxuICAgKiBFbmFibGUgQVdTIE1hbmFnZWQgUnVsZXMgZm9yIE9XQVNQIFRvcCAxMFxyXG4gICAqIERlZmF1bHQ6IHRydWVcclxuICAgKi9cclxuICBlbmFibGVPV0FTUFJ1bGVzPzogYm9vbGVhbjtcclxuICBcclxuICAvKipcclxuICAgKiBFbmFibGUgYm90IGNvbnRyb2xcclxuICAgKiBEZWZhdWx0OiB0cnVlXHJcbiAgICovXHJcbiAgZW5hYmxlQm90Q29udHJvbD86IGJvb2xlYW47XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBXYWZTdGFjayBleHRlbmRzIGNkay5TdGFjayB7XHJcbiAgcHVibGljIHJlYWRvbmx5IHdlYkFjbDogd2FmdjIuQ2ZuV2ViQUNMO1xyXG4gIHB1YmxpYyByZWFkb25seSB3ZWJBY2xBcm46IHN0cmluZztcclxuXHJcbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IFdhZlN0YWNrUHJvcHMpIHtcclxuICAgIHN1cGVyKHNjb3BlLCBpZCwgcHJvcHMpO1xyXG5cclxuICAgIGNvbnN0IHJhdGVMaW1pdCA9IHByb3BzLnJhdGVMaW1pdCA/PyAxMDA7XHJcbiAgICBjb25zdCBibG9ja2VkQ291bnRyaWVzID0gcHJvcHMuYmxvY2tlZENvdW50cmllcyA/PyBbXTtcclxuICAgIGNvbnN0IGVuYWJsZU9XQVNQUnVsZXMgPSBwcm9wcy5lbmFibGVPV0FTUFJ1bGVzID8/IHRydWU7XHJcbiAgICBjb25zdCBlbmFibGVCb3RDb250cm9sID0gcHJvcHMuZW5hYmxlQm90Q29udHJvbCA/PyB0cnVlO1xyXG5cclxuICAgIC8vIEJ1aWxkIHJ1bGVzIGFycmF5XHJcbiAgICBjb25zdCBydWxlczogd2FmdjIuQ2ZuV2ViQUNMLlJ1bGVQcm9wZXJ0eVtdID0gW107XHJcbiAgICBsZXQgcHJpb3JpdHkgPSAwO1xyXG5cclxuICAgIC8vIFJ1bGUgMDogQWxsb3cgQkZGIHJlcXVlc3RzICh3aGl0ZWxpc3QpXHJcbiAgICBydWxlcy5wdXNoKHtcclxuICAgICAgbmFtZTogJ0FsbG93QkZGUmVxdWVzdHMnLFxyXG4gICAgICBwcmlvcml0eTogcHJpb3JpdHkrKyxcclxuICAgICAgc3RhdGVtZW50OiB7XHJcbiAgICAgICAgYnl0ZU1hdGNoU3RhdGVtZW50OiB7XHJcbiAgICAgICAgICBzZWFyY2hTdHJpbmc6ICd0cnVlJyxcclxuICAgICAgICAgIGZpZWxkVG9NYXRjaDoge1xyXG4gICAgICAgICAgICBzaW5nbGVIZWFkZXI6IHtcclxuICAgICAgICAgICAgICBuYW1lOiAneC1iZmYtcmVxdWVzdCcsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgdGV4dFRyYW5zZm9ybWF0aW9uczogW1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgcHJpb3JpdHk6IDAsXHJcbiAgICAgICAgICAgICAgdHlwZTogJ05PTkUnLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgXSxcclxuICAgICAgICAgIHBvc2l0aW9uYWxDb25zdHJhaW50OiAnRVhBQ1RMWScsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSxcclxuICAgICAgYWN0aW9uOiB7XHJcbiAgICAgICAgYWxsb3c6IHt9LFxyXG4gICAgICB9LFxyXG4gICAgICB2aXNpYmlsaXR5Q29uZmlnOiB7XHJcbiAgICAgICAgc2FtcGxlZFJlcXVlc3RzRW5hYmxlZDogdHJ1ZSxcclxuICAgICAgICBjbG91ZFdhdGNoTWV0cmljc0VuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgbWV0cmljTmFtZTogJ0FsbG93QkZGUmVxdWVzdHMnLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gUnVsZSAxOiBSYXRlIGxpbWl0aW5nXHJcbiAgICBydWxlcy5wdXNoKHtcclxuICAgICAgbmFtZTogJ1JhdGVMaW1pdFJ1bGUnLFxyXG4gICAgICBwcmlvcml0eTogcHJpb3JpdHkrKyxcclxuICAgICAgc3RhdGVtZW50OiB7XHJcbiAgICAgICAgcmF0ZUJhc2VkU3RhdGVtZW50OiB7XHJcbiAgICAgICAgICBsaW1pdDogcmF0ZUxpbWl0LFxyXG4gICAgICAgICAgYWdncmVnYXRlS2V5VHlwZTogJ0lQJyxcclxuICAgICAgICB9LFxyXG4gICAgICB9LFxyXG4gICAgICBhY3Rpb246IHtcclxuICAgICAgICBibG9jazoge1xyXG4gICAgICAgICAgY3VzdG9tUmVzcG9uc2U6IHtcclxuICAgICAgICAgICAgcmVzcG9uc2VDb2RlOiA0MjksXHJcbiAgICAgICAgICAgIGN1c3RvbVJlc3BvbnNlQm9keUtleTogJ1JhdGVMaW1pdEV4Y2VlZGVkJyxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgfSxcclxuICAgICAgdmlzaWJpbGl0eUNvbmZpZzoge1xyXG4gICAgICAgIHNhbXBsZWRSZXF1ZXN0c0VuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgY2xvdWRXYXRjaE1ldHJpY3NFbmFibGVkOiB0cnVlLFxyXG4gICAgICAgIG1ldHJpY05hbWU6ICdSYXRlTGltaXRSdWxlJyxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIFJ1bGUgMjogR2VvLWJsb2NraW5nIChpZiBjb3VudHJpZXMgc3BlY2lmaWVkKVxyXG4gICAgaWYgKGJsb2NrZWRDb3VudHJpZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBydWxlcy5wdXNoKHtcclxuICAgICAgICBuYW1lOiAnR2VvQmxvY2tpbmdSdWxlJyxcclxuICAgICAgICBwcmlvcml0eTogcHJpb3JpdHkrKyxcclxuICAgICAgICBzdGF0ZW1lbnQ6IHtcclxuICAgICAgICAgIGdlb01hdGNoU3RhdGVtZW50OiB7XHJcbiAgICAgICAgICAgIGNvdW50cnlDb2RlczogYmxvY2tlZENvdW50cmllcyxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgICBhY3Rpb246IHtcclxuICAgICAgICAgIGJsb2NrOiB7XHJcbiAgICAgICAgICAgIGN1c3RvbVJlc3BvbnNlOiB7XHJcbiAgICAgICAgICAgICAgcmVzcG9uc2VDb2RlOiA0MDMsXHJcbiAgICAgICAgICAgICAgY3VzdG9tUmVzcG9uc2VCb2R5S2V5OiAnR2VvQmxvY2tlZCcsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdmlzaWJpbGl0eUNvbmZpZzoge1xyXG4gICAgICAgICAgc2FtcGxlZFJlcXVlc3RzRW5hYmxlZDogdHJ1ZSxcclxuICAgICAgICAgIGNsb3VkV2F0Y2hNZXRyaWNzRW5hYmxlZDogdHJ1ZSxcclxuICAgICAgICAgIG1ldHJpY05hbWU6ICdHZW9CbG9ja2luZ1J1bGUnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFJ1bGUgMzogQVdTIE1hbmFnZWQgUnVsZXMgLSBDb3JlIFJ1bGUgU2V0IChPV0FTUCBUb3AgMTApXHJcbiAgICBpZiAoZW5hYmxlT1dBU1BSdWxlcykge1xyXG4gICAgICBydWxlcy5wdXNoKHtcclxuICAgICAgICBuYW1lOiAnQVdTTWFuYWdlZFJ1bGVzQ29tbW9uUnVsZVNldCcsXHJcbiAgICAgICAgcHJpb3JpdHk6IHByaW9yaXR5KyssXHJcbiAgICAgICAgc3RhdGVtZW50OiB7XHJcbiAgICAgICAgICBtYW5hZ2VkUnVsZUdyb3VwU3RhdGVtZW50OiB7XHJcbiAgICAgICAgICAgIHZlbmRvck5hbWU6ICdBV1MnLFxyXG4gICAgICAgICAgICBuYW1lOiAnQVdTTWFuYWdlZFJ1bGVzQ29tbW9uUnVsZVNldCcsXHJcbiAgICAgICAgICAgIC8vIEV4Y2x1ZGUgcnVsZXMgdGhhdCBtaWdodCBjYXVzZSBmYWxzZSBwb3NpdGl2ZXNcclxuICAgICAgICAgICAgZXhjbHVkZWRSdWxlczogW1xyXG4gICAgICAgICAgICAgIHsgbmFtZTogJ1NpemVSZXN0cmljdGlvbnNfQk9EWScgfSwgLy8gQWxsb3cgbGFyZ2VyIHJlcXVlc3QgYm9kaWVzXHJcbiAgICAgICAgICAgICAgeyBuYW1lOiAnR2VuZXJpY1JGSV9CT0RZJyB9LCAvLyBDYW4gY2F1c2UgZmFsc2UgcG9zaXRpdmVzIHdpdGggSlNPTlxyXG4gICAgICAgICAgICBdLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIG92ZXJyaWRlQWN0aW9uOiB7XHJcbiAgICAgICAgICBub25lOiB7fSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHZpc2liaWxpdHlDb25maWc6IHtcclxuICAgICAgICAgIHNhbXBsZWRSZXF1ZXN0c0VuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgICBjbG91ZFdhdGNoTWV0cmljc0VuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgICBtZXRyaWNOYW1lOiAnQVdTTWFuYWdlZFJ1bGVzQ29tbW9uUnVsZVNldCcsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBSdWxlIDQ6IEFXUyBNYW5hZ2VkIFJ1bGVzIC0gS25vd24gQmFkIElucHV0c1xyXG4gICAgICBydWxlcy5wdXNoKHtcclxuICAgICAgICBuYW1lOiAnQVdTTWFuYWdlZFJ1bGVzS25vd25CYWRJbnB1dHNSdWxlU2V0JyxcclxuICAgICAgICBwcmlvcml0eTogcHJpb3JpdHkrKyxcclxuICAgICAgICBzdGF0ZW1lbnQ6IHtcclxuICAgICAgICAgIG1hbmFnZWRSdWxlR3JvdXBTdGF0ZW1lbnQ6IHtcclxuICAgICAgICAgICAgdmVuZG9yTmFtZTogJ0FXUycsXHJcbiAgICAgICAgICAgIG5hbWU6ICdBV1NNYW5hZ2VkUnVsZXNLbm93bkJhZElucHV0c1J1bGVTZXQnLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIG92ZXJyaWRlQWN0aW9uOiB7XHJcbiAgICAgICAgICBub25lOiB7fSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHZpc2liaWxpdHlDb25maWc6IHtcclxuICAgICAgICAgIHNhbXBsZWRSZXF1ZXN0c0VuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgICBjbG91ZFdhdGNoTWV0cmljc0VuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgICBtZXRyaWNOYW1lOiAnQVdTTWFuYWdlZFJ1bGVzS25vd25CYWRJbnB1dHNSdWxlU2V0JyxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIFJ1bGUgNTogQVdTIE1hbmFnZWQgUnVsZXMgLSBTUUwgSW5qZWN0aW9uXHJcbiAgICAgIHJ1bGVzLnB1c2goe1xyXG4gICAgICAgIG5hbWU6ICdBV1NNYW5hZ2VkUnVsZXNTUUxpUnVsZVNldCcsXHJcbiAgICAgICAgcHJpb3JpdHk6IHByaW9yaXR5KyssXHJcbiAgICAgICAgc3RhdGVtZW50OiB7XHJcbiAgICAgICAgICBtYW5hZ2VkUnVsZUdyb3VwU3RhdGVtZW50OiB7XHJcbiAgICAgICAgICAgIHZlbmRvck5hbWU6ICdBV1MnLFxyXG4gICAgICAgICAgICBuYW1lOiAnQVdTTWFuYWdlZFJ1bGVzU1FMaVJ1bGVTZXQnLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIG92ZXJyaWRlQWN0aW9uOiB7XHJcbiAgICAgICAgICBub25lOiB7fSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIHZpc2liaWxpdHlDb25maWc6IHtcclxuICAgICAgICAgIHNhbXBsZWRSZXF1ZXN0c0VuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgICBjbG91ZFdhdGNoTWV0cmljc0VuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgICBtZXRyaWNOYW1lOiAnQVdTTWFuYWdlZFJ1bGVzU1FMaVJ1bGVTZXQnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFJ1bGUgNjogQm90IENvbnRyb2wgKGlmIGVuYWJsZWQpXHJcbiAgICBpZiAoZW5hYmxlQm90Q29udHJvbCkge1xyXG4gICAgICBydWxlcy5wdXNoKHtcclxuICAgICAgICBuYW1lOiAnQVdTTWFuYWdlZFJ1bGVzQm90Q29udHJvbFJ1bGVTZXQnLFxyXG4gICAgICAgIHByaW9yaXR5OiBwcmlvcml0eSsrLFxyXG4gICAgICAgIHN0YXRlbWVudDoge1xyXG4gICAgICAgICAgbWFuYWdlZFJ1bGVHcm91cFN0YXRlbWVudDoge1xyXG4gICAgICAgICAgICB2ZW5kb3JOYW1lOiAnQVdTJyxcclxuICAgICAgICAgICAgbmFtZTogJ0FXU01hbmFnZWRSdWxlc0JvdENvbnRyb2xSdWxlU2V0JyxcclxuICAgICAgICAgICAgLy8gQ29uZmlndXJlIGJvdCBjb250cm9sXHJcbiAgICAgICAgICAgIG1hbmFnZWRSdWxlR3JvdXBDb25maWdzOiBbXHJcbiAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYXdzTWFuYWdlZFJ1bGVzQm90Q29udHJvbFJ1bGVTZXQ6IHtcclxuICAgICAgICAgICAgICAgICAgaW5zcGVjdGlvbkxldmVsOiAnQ09NTU9OJywgLy8gQ09NTU9OIG9yIFRBUkdFVEVEXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb3ZlcnJpZGVBY3Rpb246IHtcclxuICAgICAgICAgIG5vbmU6IHt9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdmlzaWJpbGl0eUNvbmZpZzoge1xyXG4gICAgICAgICAgc2FtcGxlZFJlcXVlc3RzRW5hYmxlZDogdHJ1ZSxcclxuICAgICAgICAgIGNsb3VkV2F0Y2hNZXRyaWNzRW5hYmxlZDogdHJ1ZSxcclxuICAgICAgICAgIG1ldHJpY05hbWU6ICdBV1NNYW5hZ2VkUnVsZXNCb3RDb250cm9sUnVsZVNldCcsXHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXRlIFdlYiBBQ0xcclxuICAgIHRoaXMud2ViQWNsID0gbmV3IHdhZnYyLkNmbldlYkFDTCh0aGlzLCAnV2ViQUNMJywge1xyXG4gICAgICBuYW1lOiBgJHtpZH0tV2ViQUNMYCxcclxuICAgICAgc2NvcGU6ICdSRUdJT05BTCcsIC8vIFVzZSAnQ0xPVURGUk9OVCcgZm9yIENsb3VkRnJvbnQgZGlzdHJpYnV0aW9uc1xyXG4gICAgICBkZWZhdWx0QWN0aW9uOiB7XHJcbiAgICAgICAgYWxsb3c6IHt9LCAvLyBBbGxvdyBieSBkZWZhdWx0LCBibG9jayBiYXNlZCBvbiBydWxlc1xyXG4gICAgICB9LFxyXG4gICAgICBydWxlcyxcclxuICAgICAgdmlzaWJpbGl0eUNvbmZpZzoge1xyXG4gICAgICAgIHNhbXBsZWRSZXF1ZXN0c0VuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgY2xvdWRXYXRjaE1ldHJpY3NFbmFibGVkOiB0cnVlLFxyXG4gICAgICAgIG1ldHJpY05hbWU6ICdXZWJBQ0wnLFxyXG4gICAgICB9LFxyXG4gICAgICBjdXN0b21SZXNwb25zZUJvZGllczoge1xyXG4gICAgICAgIFJhdGVMaW1pdEV4Y2VlZGVkOiB7XHJcbiAgICAgICAgICBjb250ZW50VHlwZTogJ0FQUExJQ0FUSU9OX0pTT04nLFxyXG4gICAgICAgICAgY29udGVudDogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgICBlcnJvcjogJ1JhdGUgbGltaXQgZXhjZWVkZWQnLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnVG9vIG1hbnkgcmVxdWVzdHMuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuJyxcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgR2VvQmxvY2tlZDoge1xyXG4gICAgICAgICAgY29udGVudFR5cGU6ICdBUFBMSUNBVElPTl9KU09OJyxcclxuICAgICAgICAgIGNvbnRlbnQ6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICAgZXJyb3I6ICdBY2Nlc3MgZGVuaWVkJyxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ0FjY2VzcyBmcm9tIHlvdXIgbG9jYXRpb24gaXMgbm90IHBlcm1pdHRlZC4nLFxyXG4gICAgICAgICAgfSksXHJcbiAgICAgICAgfSxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMud2ViQWNsQXJuID0gdGhpcy53ZWJBY2wuYXR0ckFybjtcclxuXHJcbiAgICAvLyBBc3NvY2lhdGUgd2l0aCBBUEkgR2F0ZXdheSBpZiBwcm92aWRlZFxyXG4gICAgaWYgKHByb3BzLmFwaUdhdGV3YXkpIHtcclxuICAgICAgY29uc3Qgc3RhZ2UgPSBwcm9wcy5hcGlHYXRld2F5LmRlcGxveW1lbnRTdGFnZTtcclxuICAgICAgY29uc3Qgc3RhZ2VBcm4gPSBgYXJuOmF3czphcGlnYXRld2F5OiR7dGhpcy5yZWdpb259OjovcmVzdGFwaXMvJHtwcm9wcy5hcGlHYXRld2F5LnJlc3RBcGlJZH0vc3RhZ2VzLyR7c3RhZ2Uuc3RhZ2VOYW1lfWA7XHJcblxyXG4gICAgICBuZXcgd2FmdjIuQ2ZuV2ViQUNMQXNzb2NpYXRpb24odGhpcywgJ1dlYkFDTEFzc29jaWF0aW9uJywge1xyXG4gICAgICAgIHJlc291cmNlQXJuOiBzdGFnZUFybixcclxuICAgICAgICB3ZWJBY2xBcm46IHRoaXMud2ViQWNsQXJuLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdXZWJBQ0xBc3NvY2lhdGVkV2l0aEFQSScsIHtcclxuICAgICAgICB2YWx1ZTogcHJvcHMuYXBpR2F0ZXdheS5yZXN0QXBpSWQsXHJcbiAgICAgICAgZGVzY3JpcHRpb246ICdBUEkgR2F0ZXdheSBwcm90ZWN0ZWQgYnkgV0FGJyxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gT3V0cHV0c1xyXG4gICAgbmV3IGNkay5DZm5PdXRwdXQodGhpcywgJ1dlYkFDTElkJywge1xyXG4gICAgICB2YWx1ZTogdGhpcy53ZWJBY2wuYXR0cklkLFxyXG4gICAgICBkZXNjcmlwdGlvbjogJ1dBRiBXZWIgQUNMIElEJyxcclxuICAgICAgZXhwb3J0TmFtZTogYCR7aWR9LVdlYkFDTElkYCxcclxuICAgIH0pO1xyXG5cclxuICAgIG5ldyBjZGsuQ2ZuT3V0cHV0KHRoaXMsICdXZWJBQ0xBcm4nLCB7XHJcbiAgICAgIHZhbHVlOiB0aGlzLndlYkFjbEFybixcclxuICAgICAgZGVzY3JpcHRpb246ICdXQUYgV2ViIEFDTCBBUk4nLFxyXG4gICAgICBleHBvcnROYW1lOiBgJHtpZH0tV2ViQUNMQXJuYCxcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIENsb3VkV2F0Y2ggRGFzaGJvYXJkIGZvciBXQUYgbWV0cmljc1xyXG4gICAgdGhpcy5jcmVhdGVXYWZEYXNoYm9hcmQoKTtcclxuXHJcbiAgICAvLyBUYWdzXHJcbiAgICBjZGsuVGFncy5vZih0aGlzKS5hZGQoJ0NvbXBvbmVudCcsICdTZWN1cml0eScpO1xyXG4gICAgY2RrLlRhZ3Mub2YodGhpcykuYWRkKCdNYW5hZ2VkQnknLCAnQ0RLJyk7XHJcbiAgICBjZGsuVGFncy5vZih0aGlzKS5hZGQoJ1B1cnBvc2UnLCAnV0FGIFByb3RlY3Rpb24nKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY3JlYXRlV2FmRGFzaGJvYXJkKCk6IHZvaWQge1xyXG4gICAgLy8gTm90ZTogQ2xvdWRXYXRjaCBEYXNoYm9hcmQgY3JlYXRpb24gd291bGQgZ28gaGVyZVxyXG4gICAgLy8gRm9yIG5vdywgd2UnbGwgcmVseSBvbiB0aGUgYnVpbHQtaW4gV0FGIG1ldHJpY3MgaW4gQ2xvdWRXYXRjaFxyXG4gICAgXHJcbiAgICAvLyBLZXkgbWV0cmljcyB0byBtb25pdG9yOlxyXG4gICAgLy8gLSBBbGxvd2VkUmVxdWVzdHNcclxuICAgIC8vIC0gQmxvY2tlZFJlcXVlc3RzXHJcbiAgICAvLyAtIENvdW50ZWRSZXF1ZXN0c1xyXG4gICAgLy8gLSBQYXNzZWRSZXF1ZXN0c1xyXG4gICAgLy8gLSBSYXRlTGltaXRSdWxlIChjdXN0b20gbWV0cmljKVxyXG4gICAgLy8gLSBHZW9CbG9ja2luZ1J1bGUgKGN1c3RvbSBtZXRyaWMpXHJcbiAgICBcclxuICAgIC8vIFRoZXNlIGFyZSBhdXRvbWF0aWNhbGx5IGF2YWlsYWJsZSBpbiBDbG91ZFdhdGNoIHVuZGVyIEFXUy9XQUZWMlxyXG4gIH1cclxufVxyXG4iXX0=